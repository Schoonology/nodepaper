#!/usr/bin/env node
var lib = require('../lib')
  , http = require('http')
  , $$ = require('stepdown')
  , stack = lib('stack')
  , Settings = lib('types/settings')
  , rc = lib('rc')
  , mongo = lib('mongo')

$$([
  function ($) {
    mongo.connect(rc.mongo, $.first())
  },
  function ($) {
    Settings.load({}, $.first())
  },
  function ($, settings) {
    http.createServer(stack.configure(settings)).listen(rc.port, $.first())
  },
  function ($) {
    console.info('Listening on port ' + rc.port + '...')
  }
], function handleError(err) {
  console.error(err.stack || err.message || err)
  process.exit(1)
})
